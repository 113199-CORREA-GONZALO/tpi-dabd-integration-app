<app-main-container title="Graficos estadisticos" subTitle="Varios informes estadisticos de pagos" (infoButtonClick)="showInfo()">

<div class="container">
  <!-- Filtros de fecha y botón buscar -->
  <form [formGroup]="dateForm" (ngSubmit)="buscar()">
    <div class="row mb-4">
      <div class="col-md-6"> <!-- La primera fecha ocupará la mitad del ancho -->
        <label for="startDate" class="form-label">Periodo Desde</label>
        <input
          type="month"
          id="startDate"
          class="form-control w-100"
          formControlName="startDate"
          (ngModelChange)="onDateChange()">
        <div *ngIf="dateForm.get('startDate')?.errors?.['required'] && dateForm.get('startDate')?.touched" class="text-danger mt-1">
          La fecha de inicio es requerida.
        </div>
      </div>
      <div class="col-md-6"> <!-- La segunda fecha también ocupará la mitad del ancho -->
        <label for="endDate" class="form-label">Periodo Hasta</label>
        <input
          type="month"
          id="endDate"
          class="form-control w-100"
          formControlName="endDate"
          (ngModelChange)="onDateChange()">
        <div *ngIf="dateForm.get('endDate')?.errors?.['required'] && dateForm.get('endDate')?.touched" class="text-danger mt-1">
          La fecha de fin es requerida.
        </div>
        <div *ngIf="dateForm.get('endDate')?.errors?.['endDateInvalid'] && dateForm.get('endDate')?.touched" class="text-danger mt-1">
          La fecha de fin no puede ser menor que la fecha de inicio.
        </div>
      </div>
    </div>
  </form>




  <div class="row mb-4">
    <!-- Columnas de tarjetas de resumen -->
    <div class="col-md-6 col-lg-3">
      <div class="card shadow-lg rounded-4 text-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">Resumen de Ingresos</h5>
          <p class="card-text fs-3"><i class="bi bi-cash-coin"></i> $ {{ resumenIngresos }} </p>
          <small>Promedio mensual: {{ promedioMensual }}</small>
        </div>
      </div>
      <div class="card shadow-lg rounded-4 text-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">Métodos de Pago</h5>
          <p class="card-text fs-3"><i class="bi bi-wallet2"></i> {{ metodosPago }}</p>
          <small>Método principal: {{ metodoPrincipal }} ({{ porcentajeMetodoPrincipal }}%)</small>
        </div>
      </div>
      <div class="card shadow-lg rounded-4 text-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">Boleta más alta</h5>
          <p class="card-text fs-3"><i class="bi bi-receipt"></i> $ {{ boletaMasAlta }}</p>
          <small>Promedio Top 5: ${{ promedioTop5 }}</small>
        </div>
      </div>
      <div class="card shadow-lg rounded-4 text-dark">
        <div class="card-body">
          <h5 class="card-title">MercadoPago - Promedio</h5>
          <p class="card-text fs-3"><i class="bi bi-graph-up-arrow"></i> $ {{ mercadoPagoPromedio }}</p>
          <small>{{ porcentajeTransacciones }}% de las transacciones</small>
        </div>
      </div>
    </div>

    <!-- Columna central con gráficos apilados -->
    <div class="col-md-6 col-lg-6 d-flex flex-column">
      <!-- Gráfico de comparación de ingresos -->
      <div class="card shadow-lg rounded-4 mb-4">
        <div class="card-body">
          <h3 class="card-title text-center">Comparación de Ingresos</h3>
          <div class="chart-container" style="position: relative; height: 100%;; width: 100%;">
            <canvas baseChart
                    [data]="chartDataPeriodsAmount"
                    [options]="barChartOptions"
                    chartType="bar">
            </canvas>
          </div>
        </div>
      </div>

      <!-- Gráfico TOP 5 -->
      <div class="card shadow-lg rounded-4 flex-grow-1">
        <div class="card-body">
          <h3 class="card-title text-center">TOP 5</h3>
          <p class="text-center">De expensas mas costosas</p>
          <div class="chart-container" style="position: relative; height: calc(100% - 80px); width: 100%;">
            <canvas baseChart
                    [data]="chartData"
                    [options]="barChartOptionsHorizontal"
                    chartType="bar">
            </canvas>
          </div>
        </div>
      </div>
    </div>

<!-- Gráfico de torta -->
<div class="col-md-6 col-lg-3">
  <div class="card shadow-lg rounded-4 mb-4">
    <div class="card-body">
      <h3 class="card-title text-center">Estados de Pagos</h3>
      <div class="chart-container" style="position: relative; height: 100%; width: 100%;">
        <canvas baseChart
                [data]="doughnutChartData"
                [type]="pieChartType">
        </canvas>
      </div>
    </div>
  </div>
</div>
</div>
</div>



